const t="undefined"!=typeof unsafeWindow,e=()=>{},s=t?unsafeWindow:globalThis??window,{JSON:i,document:r}=s,n=t=>t instanceof Object&&Object.getPrototypeOf(t)===Object.prototype,a=t=>void 0===t,o=t=>"string"==typeof t,h=t=>Number.isInteger(t),l=t=>h(t)||(t=>(t=>"number"==typeof t)(t)&&parseFloat(t)===t)(t)||/^-?(?:[\d]+\.)?\d+$/.test(t),c=t=>Array.isArray(t),u=t=>null===t,d=t=>"function"==typeof t;function p(t){return d(t)?t.name:t instanceof Object?Object.getPrototypeOf(t).constructor.name:void 0}function g(t,...e){d(t)&&setTimeout(t,0,...e)}function m(t){return t instanceof Object&&d(t.querySelector)}function y(t=""){if(!o(t))throw new TypeError("name must be a String");let e;for(;-1<(e=t.indexOf("-"));)t=t.slice(0,e)+t.slice(e+1,1).toUpperCase()+t.slice(e+2);return t}function f(t){if(a(t)||u(t))return null;if(o(e=t)&&(l(e)||["true","false","null"].includes(e)||["{","[",'"'].includes(e.slice(0,1))||["}","]",'"'].includes(e.slice(-1))))try{return i.parse(t)}catch(e){return t}var e;return t}function w(t){return d(t)||a(t)||o(t)?t:i.stringify(t)}function v(t,e){let s=[];for(let e in t){const i=t[e];n(i)?s=s.concat(v(i)).map((t=>[[e,t[0]].join("-"),t[1]])):s.push([e,w(i)])}return s.map((t=>e?[[e,t[0]].join("-"),t[1]]:t))}function S(t){return o(t)||m(t)||c(t)}const x=["data","dataset","html","tag","callback"];function E(t="div",e={},s=null){if(n(t)&&(t=(e=t).tag??"div"),"string"!=typeof t)throw new TypeError("tag must be a String");S(e)&&(s=e,e={});const i=o(a=t)&&a.startsWith("<")&&a.endsWith(">")?function(t){if(o(t)&&t.length>0){let e=E("template",t).content;if(0===e.childNodes.length)return;return e.childNodes.length>1?[...e.childNodes]:e.childNodes[0]}}(t):r.createElement(t);var a;let h;if(!m(i))throw new TypeError("Invalid tag supplied "+t);if(n(e)){const t=[];h=e.callback,S(s)||(s=e.html),n(e.data)&&t.push(...v(e.data,"data")),n(e.dataset)&&t.push(...v(e.dataset,"data")),t.forEach((t=>i.setAttribute(...t))),c(e.class)&&(e.class=e.class.join(" "));for(let t in e){if(x.includes(t))continue;let s=e[t];if(o(s)){let e=i.getAttribute(t)??"";e.length>0&&(s=e+" "+s),i.setAttribute(t,s)}else n(s)?v(s,t).forEach((t=>i.setAttribute(...t))):i[t]=s}}if(S(s)){c(s)||(s=[s]);for(let t of s)m(t)?i.appendChild(t):i.innerHTML+=t}return d(h)&&h(i),i}function b(t){if(o(t)){const e=b.a??=E("a");b.a.href=t,t=new URL(e.href)}if(t instanceof URL)return t}class I{static get default(){return this.cases()[0]}static tryFrom(t){return p(t)!==p(this)||d(t)?this.cases().find((e=>e.value===t)):t}static from(t){const e=this.tryFrom(t);if(a(e))throw new TypeError("Cannot find matching enum to: "+w(t));return e}static cases(){return this.keys.map((t=>this[t]))}static get keys(){return Object.keys(this).filter((t=>t[0]===t[0].toUpperCase()&&this[t]instanceof I))}static get size(){return this.keys.length}get name(){return Object.keys(this.constructor).find((t=>this.constructor[t]===this))??""}constructor(t){if(Object.getPrototypeOf(this)===I.prototype)throw new Error("Cannot instantiate BackedEnum directly, it must be extended.");if(a(t)||d(t))throw new TypeError("value is not valid");Object.defineProperty(this,"value",{writable:!1,configurable:!1,enumerable:!0,value:t})}}const k=36e5,M={days:864e5,hours:k,minutes:6e4,seconds:1e3,miliseconds:1};class A{#t=0;#e=!1;#s=!1;#i=0;#r;get startTime(){return this.#t}get stopped(){return 0===this.#t}get running(){return this.#e}get paused(){return this.#s}get elapsed(){return this.#e?+new Date-this.#t:this.#i}get laps(){return this.#r}start(){this.#e||this.#t||(this.#e=!0,this.#r=[],this.#i=0,this.#t=+new Date)}stop(){if(!this.#e)return this.#i;this.#e=!1;let t=this.#t;return this.#t=0,this.#i=+new Date-t}pause(){return!this.#s&&this.#e&&(this.#s=!0,this.#e=!1,this.#i=+new Date-this.#t),this.#i}resume(){this.#s&&!this.stopped&&(this.#s=!1,this.#e=!0,this.#t=+new Date-this.#i)}lap(){let t=this.#r[this.#r.length-1];if(!this.#e)return t??0;let e=t??this.#t,s=this.elapsed-e;return this.#r.push(s),s}constructor(t=!0){this.#r=[],t&&this.start()}}class T{#n;#a;get data(){return this.#a}get days(){return""+this.#a.days}get hours(){return this.#a.hours<10?`0${this.#a.hours}`:`${this.#a.hours}`}get minutes(){return this.#a.minutes<10?`0${this.#a.minutes}`:`${this.#a.minutes}`}get seconds(){return this.#a.seconds<10?`0${this.#a.seconds}`:`${this.#a.seconds}`}get miliseconds(){return this.#a.miliseconds<10?this.#a.miliseconds<100?"00"+this.#a.miliseconds:"0"+this.#a.miliseconds:""+this.#a.miliseconds}get timestamp(){return this.#n}static of(t){return new T(t)}constructor(t){if(!h(t))throw new TypeError("timestamp must be an integer");this.#n=t,this.#a={};for(let e in M){let s=M[e],i=Math.floor(t/s);t-=i*s,this.#a[e]=i}}toString(){return`${this.days}d ${this.hours}:${this.minutes}:${this.seconds}.${this.miliseconds}s`}export(){return Object.assign({timestamp:this.#n},this.#a)}}class L{static of(t){return new L(t)}min={x:0,y:0};max={x:0,y:0};constructor({x:t,y:e,width:s,height:i}){let r=Math.floor(s/4),n=Math.floor(i/4);this.min.x=t+r,this.max.x=t+s-r,this.min.y=e+n,this.max.y=e+i-n}intersects(t){return t instanceof L!=!1&&!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}}class j{world;get x(){throw new Error(p(this)+".x not implemented")}get y(){throw new Error(p(this)+".y not implemented")}get width(){throw new Error(p(this)+".width not implemented")}get height(){throw new Error(p(this)+".height not implemented")}isEnemy=!1;get scoreGain(){return 0}get name(){return p(this)}get ctx(){return this.world.ctx}get box(){return L.of(this)}isIntersecting(t){return t instanceof j!=!1&&this.box.intersects(t.box)}draw(){throw new Error(p(this)+".draw() is not implemented")}constructor(t){if(t instanceof Ot==!1)throw new TypeError("Invalid world !!!");this.world=t}destroy(){this.destroyed=!0}}const O="./assets/sounds",q="./assets/pictures",H=q+"/worlds",D=q+"/hiro",N=q+"/enemy",C=[...Array(3)].map(((t,e)=>N+"/loot/"+(e+1)+".png")),P=new Map;class G extends I{static MOVING=new G("moving");get sprites(){return STATES.get(this.value)[0]}getAnimation(t){return P.has(t)||P.set(t,lt(C)),P.get(t)}}class Y extends j{width=100;height=100;y=150;#o=null;get x(){return this.#o??=this.world.width+Math.floor(Math.random()*this.world.width*Math.ceil(3*Math.random()))}set x(t){this.#o=t}#h;get scoreGain(){return this.#h??=Math.ceil(250*Math.random())}isEnemy=!1;isDead=!1;draw(){const{ctx:t}=this;this.move(),this.x>this.world.width-this.width||t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}move(){this.state=G.MOVING,this.world.hero.isDead||(this.currentSprite=this.state.getAnimation(this)(),this.x-=this.world.stage.speed),this.x<=0&&(this.#o=null)}destroy(){super.destroy(),this.isDead=!0}}const V=new Map,$=new Map,J=[];class F extends I{static SYNC=new F("sync");static ASYNC=new F("async")}function U(t,s,i=e){let r;if(r=$.get(t).get(s))return r;let n,o=null;const h=new Set,l=t=>{a(t)||u(t)||c(t)},c=e=>{if(function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}(o,e)){o=e;const i=!J.length;for(let t of h)t[1](),J.push([t[0],o]);if(i){t.setItem(s,o);for(let t of J)t[0](t[1]);J.length=0}}};return r={subscribe:(t,s=e)=>{if(d(t)){const r=[t,s];return h.add(r),1===h.size&&(n=i(c)??e),t(o),()=>{h.delete(r),0===h.size&&n&&(n(),n=null)}}},set:c,update:t=>{d(t)&&c(t(o))},get:(e=null)=>{let i=t.getItem(s);return null===i?(d(e)&&((e=e())instanceof Promise?e.then((t=>l(t))):l(e)),e):i}},Object.defineProperty(r,"length",{configurable:!0,get:()=>h.size}),$.get(t).set(s,r),r}class R{get type(){return F.SYNC}constructor(t=""){t&&!t.endsWith(":")&&(t+=":"),V.set(this,t),$.set(this,new Map)}static get type(){return this.prototype.type}key(t){return V.get(this)+t}subscribe(t,s,i=e){return this.hook(t).subscribe(s,i)}hasItem(t){return null!==this.getItem(t)}removeItem(t){this.setItem(t,null)}setMany(t={}){const e=new Map;for(let s in t){const i=t[s];e.set(s,this.setItem(s,i))}return e}getMany(t=[],e=null){return t.map((t=>[t,this.getItem(t,e)]))}hook(t,e=null){return U(this,t,(s=>{s(this.getItem(t,e))}))}clear(){const t=this.keys;for(let e of t)this.removeItem(e);return t}get keys(){throw new Error(p(this)+".keys not implemented.")}getItem(t,e=null){return d(e)&&((e=e())instanceof Promise?e.then((e=>this.setItem(t,e))):this.setItem(t,e)),e}setItem(t,e){throw new Error(p(this)+".setItem() not implemented.")}}if("undefined"==typeof Storage){const t=new Map;class e{get length(){return t.size}key(e){return[...t.keys()][e]??null}clear(){t.clear()}getItem(e){return t.get(e)??null}setItem(e,s){t.set(String(e),String(s))}getItem(e){return t.get(e)??null}removeItem(e){t.delete(e)}}globalThis.Storage??=e,globalThis.localStorage??=new e,globalThis.sessionStorage??=new e,globalThis.addEventListener??=()=>{},globalThis.removeEventListener??=()=>{}}const W="NGSOFT:UUID";function X(){let e="";return t?(null===(e=localStorage.getItem(W))&&localStorage.setItem(W,e=function(){let t,e,s="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(s+="-"),s+=(12==t?4:16==t?3&e|8:e).toString(16);return s}()+":"),e):e}class z extends R{#l;get store(){return this.#l}constructor(t,e=X()){if(t??=localStorage,t instanceof Storage==!1)throw new TypeError("storage not an instance of Storage");super(e),this.#l=t}get keys(){const t=[],e=this.key(""),{store:s}=this;for(let i=0;i<s.length;i++){let r=s.key(i);r.startsWith(e)&&t.push(r.slice(e.length))}return t}getItem(t,e=null){let s=this.store.getItem(this.key(t));return o(s)?super.getItem(t,f(s)):super.getItem(t,e)}setItem(t,e){return null===e?this.store.removeItem(this.key(t)):this.store.setItem(this.key(t),w(e)),e}hook(t,e=null){return U(this,t,(s=>{const i=e=>{e.storageArea===this.store&&e.key===this.key(t)&&s(f(e.newValue))};return addEventListener("storage",i),s(this.getItem(t,e)),()=>{removeEventListener("storage",i)}}))}}const K=new z;new z(sessionStorage);const B=new Set;function Q(t){return new Promise(((e,s)=>{m(t)?function(t,e){d(e)&&(B.has(t)?e(t):t.readyState>=2?(B.add(t),e(t)):t.addEventListener("canplay",(()=>{B.add(t),e(t)})))}(t,(()=>{if(t.currentTime=0,setTimeout((()=>{e(t)}),1e3*t.duration+20),t.paused&&!t.muted)try{t.play()}catch(t){}})):s(new TypeError("not an element"))}))}const Z=K.hook("muted",!1),_=".ogg",tt=new Map,et=document.querySelector("#audioplayers");class st extends I{constructor(t){super(t),this.load()}static pauseAll(){this.cases().forEach((t=>t.pause()))}get url(){throw new Error(p(this)+".url not implemented.")}set player(t){tt.set(this,t),Z.subscribe((e=>{t.muted=e||null}))}get player(){return tt.get(this)}play(){return this.load(),Q(this.player)}pause(){this.player?.pause()}destroy(){this.player&&(this.pause(),et.removeChild(this.player),tt.delete(this))}load(){if(!this.player){const t=E("audio",{src:this.url});et.appendChild(t),this.player=t}}}class it extends st{static Stage1=new it(1);static Stage2=new it(2);static Stage3=new it(3);static Stage4=new it(4);static Stage5=new it(5);static Stage6=new it(6);static Stage7=new it(7);static Stage8=new it(8);get url(){return b(O+"/soundtrack/"+this.value+_)}}class rt extends st{static DEATH=new rt("death");static DROP=new rt("drop");static HIT=new rt("hit");static JUMP=new rt("jump");static LEVEL=new rt("level");static SLASH=new rt("slash");static BEHEADING=new rt("beheading");get url(){return b(O+"/effects/"+this.value+_)}}let nt=0;const at=new Set;function ot(t=e){let s=0;return e=>{s++,nt++,e.onload=()=>{s--,nt--,0===s&&(t(),0===nt&&at.forEach((t=>t())))}}}const ht=ot();function lt(t,e=!0){let s=0,i=0;const r=t.map((t=>{const e=new Image;return ht(e),e.src=t,e}));return()=>{let t=!0;return i++,i%8==0&&s++,s>=r.length&&(s=0,t=e),t&&r[s]}}const ct=new Map([["moving",[[...Array(9)].map(((t,e)=>D+"/moving/"+(e+1)+".png")),!0]],["attacking",[[...Array(6)].map(((t,e)=>D+"/attacking/"+(e+1)+".png")),!1]],["dead",[[...Array(10)].map(((t,e)=>D+"/dead/"+(e+1)+".png")),!1]]]);class ut extends I{static MOVING=new ut("moving");static ATTACKING=new ut("attacking");static DEAD=new ut("dead");get sprites(){return ct.get(this.value)[0]}#c;getAnimation(){return this.#c??=lt(...ct.get(this.value))}}class dt extends j{maxHP=6;hp=6;killCount=0;x=100;y=350;width=150;height=150;minY=150;maxY=350;gravity=1;jumpStep=10;deltaY=0;isJumping=!1;isAttacking=!1;isDead=!1;state=ut.MOVING;currentSprite=!1;intercepting=[];draw(){const{ctx:t}=this;this.isJumping&&this.jump(),this.isAttacking&&this.attack(),this.isAttacking||this.move(),this.intersections(),this.isDead&&this.dead(),this.currentSprite&&t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}dead(){this.isDead&&(this.state=ut.DEAD,!1===(this.currentSprite=this.state.getAnimation(this)())&&(this.world.pause(),this.world.trigger("dead",{item:this})))}move(){this.state=ut.MOVING,this.currentSprite=this.state.getAnimation(this)()}attack(){this.isAttacking&&(this.state=ut.ATTACKING,!1===(this.currentSprite=this.state.getAnimation(this)())&&(this.isAttacking=!1)),this.isAttacking||(this.state=ut.MOVING,this.move())}jump(){if(this.isJumping){if(0===this.deltaY)this.deltaY=-this.jumpStep*this.gravity;else if(this.y<=this.minY)this.deltaY=-1*this.deltaY,this.y=this.minY;else if(this.y>=this.maxY)return this.deltaY=0,this.isJumping=!1,void(this.y=this.maxY);this.y+=this.deltaY}}intersections(){this.intercepting=this.intercepting.filter((t=>!(t.destroyed||!t.isIntersecting(this))));for(let t of[...this.world.objects])t.isIntersecting(this)&&!this.intercepting.includes(t)&&t.scoreGain>0&&(this.intercepting.push(t),!t.isEnemy||this.isAttacking?(this.world.score+=t.scoreGain,this.world.destroyObject(t),t instanceof Y&&rt.DROP.play(),t.isEnemy&&(rt.BEHEADING.play(),this.killCount++),this.world.trigger("scoregain",{item:t})):t.isEnemy&&(this.hp--,this.world.trigger("hploss",{item:t}),this.hp<=0?(rt.pauseAll(),rt.DEATH.play(),this.isDead=!0):rt.HIT.play()))}}let pt={set(t,e,s){gt.includes(s)&&this.remove(t,e),mt(e).forEach((e=>{t.dataset[e]=w(s)}))},get(t,e,s=null){let i=mt(e).map((e=>f(t.dataset[e]))).map((t=>gt.includes(t)?s:t));return i.length<=1?i[0]??s:i},remove(t,e){mt(e).forEach((e=>delete t.dataset[e]))}},gt=[null,undefined];function mt(t){let e=[];return o(t)&&(t.startsWith("data-")&&(t=t.slice(5)),e=[y(t)]),c(t)&&(e=e.concat(...t.map((t=>mt(t))))),e}function yt(t){return ft(t)?[t]:t instanceof NodeList?[...t]:c(t)?t.filter((t=>ft(t))):function(t){try{return o(t)&&null===r.createElement("template").querySelector(t)}catch(t){return!1}}(t)?[...document.querySelectorAll(t)]:[]}function ft(t){return t instanceof Object&&t.dataset instanceof DOMStringMap}function wt(t,e,s){function i(e,s=null){let i=t[0];return ft(i)?pt.get(i,e,s):s}function r(e,s){if(n(e))for(let t in e)r(t,e[t]);else t.forEach((t=>pt.set(t,e,s)));return a}t=yt(t);const a={get:i,set:r,remove:function(e){return t.forEach((t=>pt.remove(t,e))),a}};switch(arguments.length){case 2:return i(e);case 3:return r(e,s)}return a}const vt=[[...Array(9)].map(((t,e)=>N+"/cyclops/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>N+"/minos/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>N+"/wherewolf/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>N+"/orc/"+(e+1)+".png"))],St=new Map([["moving",[[...Array(9)].map(((t,e)=>N+"/demon/moving/"+(e+1)+".png")),!0]]]),xt=new Map;class Et extends I{static MOVING=new Et("moving");get sprites(){return St.get(this.value)[0]}getAnimation(t){return xt.has(t)||xt.set(t,lt(t.sprites)),xt.get(t)}}class bt extends j{isEnemy=!0;isDead=!1;#h;get scoreGain(){return this.#h??=Math.ceil(500*Math.random())}get width(){return this.world.hero.width}get height(){return this.world.hero.height}get y(){return this.world.hero.maxY}set y(t){}#o;get x(){return this.#o??=this.world.width+Math.floor(Math.random()*this.world.width*Math.ceil(3*Math.random()))}set x(t){this.#o=t}#u;get sprites(){return this.#u??=vt[Math.floor(Math.random()*vt.length)]}state=Et.MOVING;currentSprite=!1;draw(){const{ctx:t}=this;this.move(),this.x>this.world.width-this.width||t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}move(){this.state=Et.MOVING,this.world.hero.isDead||(this.currentSprite=this.state.getAnimation(this)(),this.x-=this.world.stage.speed),this.x<=0&&(this.#o=null)}destroy(){super.destroy(),this.isDead=!0}}const It=ot();const kt=[...Array(8)].map(((t,e)=>H+"/stage"+(e+1)+".png")),Mt=kt.map((function(t){const e=new Image;return It(e),e.src=t,e}));class At extends j{#d=0;get level(){return this.#d}set level(t){this.#d=t,wt(this.canvas,"stage",this.stage),this.reset(),this.world.trigger("levelchange")}enemies=0;enemiesPerStageRatio=8;get soundtrack(){return it.cases()[this.level]}get maxEnemies(){return this.stage*this.enemiesPerStageRatio}get stage(){return this.level+1}loops=0;loopIncreased=!1;get maxLoops(){return this.world.loopsToClearStage}speed=8;deltaX=0;x=0;y=0;get width(){return this.world.width}get height(){return this.world.height}get picture(){return kt[this.level]??kt.slice(-1)[0]}get decor(){return Mt[this.level]??Mt.slice(-1)[0]}get canvas(){return this.world.canvas}reset(){this.enemies=this.deltaX=this.loops=0,this.loopIncreased=!1,this.world.objects.length=0,this.canvas.style=""}draw(){this.generateEnemies();const{canvas:t}=this;this.world.hero.isDead||(this.deltaX+=this.speed),this.deltaX>=this.width&&(this.deltaX=0,this.loops++,this.loopIncreased=!0,this.loops>=this.maxLoops&&(this.world.pause(),this.world.trigger("stagecleared"))),t.style.backgroundPositionX=`-${this.deltaX}px`}generateEnemy(){this.enemies<this.maxEnemies&&(this.world.objects.push(new bt(this.world)),this.world.objects.push(new Y(this.world)),this.enemies++)}generateEnemies(){(0===this.enemies||this.loopIncreased)&&(this.loopIncreased&&(this.loopIncreased=!1),this.enemies<this.maxEnemies&&this.generateEnemy())}constructor(t){super(t),t.on("started resume levelchange",(()=>{it.pauseAll(),this.soundtrack.play()})).on("paused stagecleared",(()=>{this.soundtrack.pause()}))}}class Tt{#p;#g;get length(){return this.#p.length}constructor(t=!0){this.#p=[],this.#g=!0===t}on(t,e,s=!1){if(!o(t))throw new TypeError("Invalid event type, not a String.");if(!d(e))throw new TypeError("Invalid listener, not a function");return t.split(/\s+/).forEach((t=>{this.#p.push({type:t,listener:e,once:!0===s})})),this}one(t,e){return this.on(t,e,!0)}off(t,e){if(!o(t))throw new TypeError("Invalid event type, not a String.");return t.split(/\s+/).forEach((t=>{this.#p=this.#p.filter((s=>!!(t!==s.type||e!==s.listener&&e)))})),this}trigger(t,e=null,s=null){let i;if(s??=this.#g,t instanceof Event&&(i=t,i.data??=e,t=i.type),!o(t)&&t instanceof Event==!1)throw new TypeError("Invalid event type, not a String|Event.");const r=[];return t.split(/\s+/).forEach((t=>{if(!r.includes(t)){r.push(t);for(let r of function(t,e){return t.filter((t=>t.type===e))}(this.#p,t))r.type===t&&(s?g(r.listener,i??{type:t,data:e}):r.listener(i??{type:t,data:e}),r.once&&this.off(t,r.listener))}})),this}mixin(t){return t instanceof Object&&["on","off","one","trigger"].forEach((e=>{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:(...s)=>(this[e](...s),t)})})),this}static mixin(t,e=!0){return new Tt(e).mixin(t)}static on(t,e,s=!1){return Lt.on(t,e,s)}static one(t,e){return Lt.one(t,e)}static off(t,e){return Lt.off(t,e)}static trigger(t,e=null,s=null){return Lt.trigger(t,e,s)}}const Lt=new Tt;let jt=!1;class Ot{element;paused=!0;timeout=null;score=0;loopsToClearStage=15;objects=[];get ctx(){return this.canvas.getContext("2d")}get width(){return f(this.canvas.width)}get height(){return f(this.canvas.height)}get time(){const t=T.of(this.chrono.elapsed);return(t.hours>0?t.hours+":":"")+t.minutes+":"+t.seconds}constructor({element:t}={}){Tt.mixin(this,!1),this.element=t,this.chrono=new A(!1),this.displayScore=t.querySelector("#score"),this.displayTime=t.querySelector("#time"),this.displayHP=t.querySelector("#lives"),this.displayKill=t.querySelector(".killed-span"),this.displayHeart=t.querySelector(".heart-span"),this.canvas=t.querySelector("canvas")}destroy(){this.pause(),jt=!1,this.objects.forEach((t=>t.destroy())),requestAnimationFrame((()=>this.clearScreen()))}destroyObject(t){if(t instanceof j){let e=this.objects.indexOf(t);e>-1&&(t.destroy(),this.objects.splice(e,1))}}init(){jt||(this.stage=new At(this),this.hero=new dt(this),this.objects.length=0,this.stage.level=7,this.resume())}pause(){this.paused||(this.paused=!0,this.chrono.pause(),this.timeout&&(cancelAnimationFrame(this.timeout),this.timeout=null),this.trigger("paused"))}resume(){this.paused&&(this.paused=!1,this.chrono.stopped?(this.chrono.start(),this.trigger("started")):(this.chrono.resume(),this.trigger("resume")),requestAnimationFrame((()=>this.draw())))}clearScreen(){this.ctx.clearRect(0,0,this.width,this.height)}draw(){if(this.paused)return;const{displayScore:t,displayTime:e,displayHP:s,displayKill:i,displayHeart:r}=this;this.clearScreen(),this.stage.draw(),this.objects.forEach((t=>t.draw())),this.hero.draw(),t.innerHTML=this.score,e.innerHTML=this.time,wt(s,"lives",this.hero.hp),r.innerHTML=this.hero.hp,i.innerHTML=this.hero.killCount,this.timeout=requestAnimationFrame((()=>this.draw()))}}const qt=document.querySelector(".start-menu"),Ht=document.querySelector(".death-container"),Dt=document.querySelector(".level"),Nt=document.querySelector(".victory"),Ct=document.querySelector(".pause"),Pt=document.querySelector(".credits"),Gt=document.querySelector("#goty"),Yt=document.querySelector(".stage-span");let Vt;addEventListener("keydown",(t=>{const{key:e}=t;if(" "===e){if(Vt.paused)return;t.preventDefault(),Vt.hero.isJumping||(Vt.hero.isJumping=!0,rt.JUMP.play())}else if("p"===e)t.preventDefault(),Vt.paused?Vt.resume():Vt.pause();else if("e"===e){if(Vt.paused)return;t.preventDefault(),Vt.hero.isAttacking||(rt.SLASH.play(),Vt.hero.isAttacking=!0)}})),addEventListener("click",(({target:t})=>{Vt&&(Vt.paused||t.closest("#game")&&!Vt.hero.isAttacking&&(rt.SLASH.play(),Vt.hero.isAttacking=!0))})),qt.addEventListener("click",(t=>{const{target:e}=t;e.closest(".start-menu-btn")?(Vt=new Ot({element:document.querySelector("#game")}),Vt.on("paused",(()=>{Ct.hidden=null})).on("resume started",(()=>{Ct.hidden=!0})).on("stagecleared",(()=>{if(Ct.hidden=!0,8===Vt.stage.stage)rt.pauseAll(),Nt.querySelector(".score-span").innerHTML=Vt.score,Nt.querySelector(".time-span").innerHTML=Vt.time,Nt.querySelector(".killed-span").innerHTML=Vt.hero.killCount,Nt.hidden=null,rt.LEVEL.play().then((()=>{Nt.addEventListener("click",(()=>{Nt.hidden=!0,Vt.destroy(),qt.hidden=null,Gt.hidden=null}),{once:!0})}));else{const{hero:t}=Vt,e={hp:t.hp,score:Vt.score};for(;t.hp<t.maxHP&&Vt.score>=1e3;)Vt.score-=1e3,t.hp++;Dt.querySelector(".score .before").innerHTML=e.score,Dt.querySelector(".lives .before").innerHTML=e.hp,Dt.querySelector(".score .diff").innerHTML=Math.abs(e.score-Vt.score),Dt.querySelector(".lives .diff").innerHTML=Math.abs(t.hp-e.hp),Dt.querySelector(".score .current").innerHTML=Vt.score,Dt.querySelector(".lives .current").innerHTML=t.hp,Dt.hidden=null,rt.pauseAll(),rt.LEVEL.play().then((()=>{Dt.hidden=!0,Vt.stage.level++}))}})).on("dead",(()=>{Ht.querySelector(".score-span").innerHTML=Vt.score,Ht.querySelector(".time-span").innerHTML=Vt.time,Ht.querySelector(".killed-span").innerHTML=Vt.hero.killCount,Ct.hidden=!0,Ht.hidden=null})).on("levelchange",(()=>{Yt.innerHTML=Vt.stage.stage,Vt.resume()})),qt.hidden=!0,Gt.hidden=!0,Vt.init()):e.closest(".start-menu-credit")&&(Pt.hidden=null)})),Pt.addEventListener("click",(()=>{Pt.hidden=!0})),Ct.addEventListener("click",(({target:t})=>{t.closest(".ctn-img")&&Vt.resume()})),Ht.addEventListener("click",(({target:t})=>{t.closest(".retry")&&(Ht.hidden=!0,Vt.destroy(),qt.hidden=null,Gt.hidden=null)}));

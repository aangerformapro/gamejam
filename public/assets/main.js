const t="undefined"!=typeof unsafeWindow,e=()=>{},s=t?unsafeWindow:globalThis??window,{JSON:i,document:r}=s,n=t=>t instanceof Object&&Object.getPrototypeOf(t)===Object.prototype,a=t=>void 0===t,o=t=>"string"==typeof t,h=t=>Number.isInteger(t),l=t=>h(t)||(t=>(t=>"number"==typeof t)(t)&&parseFloat(t)===t)(t)||/^-?(?:[\d]+\.)?\d+$/.test(t),c=t=>Array.isArray(t),u=t=>null===t,d=t=>"function"==typeof t;function g(t){return d(t)?t.name:t instanceof Object?Object.getPrototypeOf(t).constructor.name:void 0}function p(t,...e){d(t)&&setTimeout(t,0,...e)}function m(t){return t instanceof Object&&d(t.querySelector)}function f(t=""){if(!o(t))throw new TypeError("name must be a String");let e;for(;-1<(e=t.indexOf("-"));)t=t.slice(0,e)+t.slice(e+1,1).toUpperCase()+t.slice(e+2);return t}function y(t){if(a(t)||u(t))return null;if(o(e=t)&&(l(e)||["true","false","null"].includes(e)||["{","[",'"'].includes(e.slice(0,1))||["}","]",'"'].includes(e.slice(-1))))try{return i.parse(t)}catch(e){return t}var e;return t}function w(t){return d(t)||a(t)||o(t)?t:i.stringify(t)}function v(t,e){let s=[];for(let e in t){const i=t[e];n(i)?s=s.concat(v(i)).map((t=>[[e,t[0]].join("-"),t[1]])):s.push([e,w(i)])}return s.map((t=>e?[[e,t[0]].join("-"),t[1]]:t))}function x(t){return o(t)||m(t)||c(t)}const S=["data","dataset","html","tag","callback"];function E(t="div",e={},s=null){if(n(t)&&(t=(e=t).tag??"div"),"string"!=typeof t)throw new TypeError("tag must be a String");x(e)&&(s=e,e={});const i=o(a=t)&&a.startsWith("<")&&a.endsWith(">")?function(t){if(o(t)&&t.length>0){let e=E("template",t).content;if(0===e.childNodes.length)return;return e.childNodes.length>1?[...e.childNodes]:e.childNodes[0]}}(t):r.createElement(t);var a;let h;if(!m(i))throw new TypeError("Invalid tag supplied "+t);if(n(e)){const t=[];h=e.callback,x(s)||(s=e.html),n(e.data)&&t.push(...v(e.data,"data")),n(e.dataset)&&t.push(...v(e.dataset,"data")),t.forEach((t=>i.setAttribute(...t))),c(e.class)&&(e.class=e.class.join(" "));for(let t in e){if(S.includes(t))continue;let s=e[t];if(o(s)){let e=i.getAttribute(t)??"";e.length>0&&(s=e+" "+s),i.setAttribute(t,s)}else n(s)?v(s,t).forEach((t=>i.setAttribute(...t))):i[t]=s}}if(x(s)){c(s)||(s=[s]);for(let t of s)m(t)?i.appendChild(t):i.innerHTML+=t}return d(h)&&h(i),i}function b(t){if(o(t)){const e=b.a??=E("a");b.a.href=t,t=new URL(e.href)}if(t instanceof URL)return t}class I{static get default(){return this.cases()[0]}static tryFrom(t){return g(t)!==g(this)||d(t)?this.cases().find((e=>e.value===t)):t}static from(t){const e=this.tryFrom(t);if(a(e))throw new TypeError("Cannot find matching enum to: "+w(t));return e}static cases(){return this.keys.map((t=>this[t]))}static get keys(){return Object.keys(this).filter((t=>t[0]===t[0].toUpperCase()&&this[t]instanceof I))}static get size(){return this.keys.length}get name(){return Object.keys(this.constructor).find((t=>this.constructor[t]===this))??""}constructor(t){if(Object.getPrototypeOf(this)===I.prototype)throw new Error("Cannot instantiate BackedEnum directly, it must be extended.");if(a(t)||d(t))throw new TypeError("value is not valid");Object.defineProperty(this,"value",{writable:!1,configurable:!1,enumerable:!0,value:t})}}const k=36e5,A={days:864e5,hours:k,minutes:6e4,seconds:1e3,miliseconds:1};class M{#t=0;#e=!1;#s=!1;#i=0;#r;get startTime(){return this.#t}get stopped(){return 0===this.#t}get running(){return this.#e}get paused(){return this.#s}get elapsed(){return this.#e?+new Date-this.#t:this.#i}get laps(){return this.#r}start(){this.#e||this.#t||(this.#e=!0,this.#r=[],this.#i=0,this.#t=+new Date)}stop(){if(!this.#e)return this.#i;this.#e=!1;let t=this.#t;return this.#t=0,this.#i=+new Date-t}pause(){return!this.#s&&this.#e&&(this.#s=!0,this.#e=!1,this.#i=+new Date-this.#t),this.#i}resume(){this.#s&&!this.stopped&&(this.#s=!1,this.#e=!0,this.#t=+new Date-this.#i)}lap(){let t=this.#r[this.#r.length-1];if(!this.#e)return t??0;let e=t??this.#t,s=this.elapsed-e;return this.#r.push(s),s}constructor(t=!0){this.#r=[],t&&this.start()}}class T{#n;#a;get data(){return this.#a}get days(){return""+this.#a.days}get hours(){return this.#a.hours<10?`0${this.#a.hours}`:`${this.#a.hours}`}get minutes(){return this.#a.minutes<10?`0${this.#a.minutes}`:`${this.#a.minutes}`}get seconds(){return this.#a.seconds<10?`0${this.#a.seconds}`:`${this.#a.seconds}`}get miliseconds(){return this.#a.miliseconds<10?this.#a.miliseconds<100?"00"+this.#a.miliseconds:"0"+this.#a.miliseconds:""+this.#a.miliseconds}get timestamp(){return this.#n}static of(t){return new T(t)}constructor(t){if(!h(t))throw new TypeError("timestamp must be an integer");this.#n=t,this.#a={};for(let e in A){let s=A[e],i=Math.floor(t/s);t-=i*s,this.#a[e]=i}}toString(){return`${this.days}d ${this.hours}:${this.minutes}:${this.seconds}.${this.miliseconds}s`}export(){return Object.assign({timestamp:this.#n},this.#a)}}class j{static of(t){return new j(t)}min={x:0,y:0};max={x:0,y:0};constructor({x:t,y:e,width:s,height:i}){let r=Math.floor(s/4),n=Math.floor(i/4);this.min.x=t+r,this.max.x=t+s-r,this.min.y=e+n,this.max.y=e+i-n}intersects(t){return t instanceof j!=!1&&!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}}class O{world;get x(){throw new Error(g(this)+".x not implemented")}get y(){throw new Error(g(this)+".y not implemented")}get width(){throw new Error(g(this)+".width not implemented")}get height(){throw new Error(g(this)+".height not implemented")}isEnemy=!1;get scoreGain(){return 0}get name(){return g(this)}get ctx(){return this.world.ctx}get box(){return j.of(this)}isIntersecting(t){return t instanceof O!=!1&&this.box.intersects(t.box)}draw(){throw new Error(g(this)+".draw() is not implemented")}constructor(t){if(t instanceof Mt==!1)throw new TypeError("Invalid world !!!");this.world=t}destroy(){this.destroyed=!0}}const D="./assets/sounds",L="./assets/pictures",q=L+"/worlds",N=L+"/hiro",P=L+"/enemy",C=[...Array(3)].map(((t,e)=>P+"/loot/"+(e+1)+".png")),G=new Map;class Y extends I{static MOVING=new Y("moving");get sprites(){return STATES.get(this.value)[0]}getAnimation(t){return G.has(t)||G.set(t,ot(C)),G.get(t)}}class H extends O{width=100;height=100;y=150;#o=null;get x(){return this.#o??=this.world.width+Math.floor(Math.random()*this.world.width*Math.ceil(3*Math.random()))}set x(t){this.#o=t}#h;get scoreGain(){return this.#h??=Math.ceil(250*Math.random())}isEnemy=!1;isDead=!1;draw(){const{ctx:t}=this;this.move(),this.x>this.world.width-this.width||t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}move(){this.state=Y.MOVING,this.world.hero.isDead||(this.currentSprite=this.state.getAnimation(this)(),this.x-=this.world.stage.speed),this.x<=0&&(this.#o=null)}destroy(){super.destroy(),this.isDead=!0}}const V=new Map,$=new Map,X=[];class J extends I{static SYNC=new J("sync");static ASYNC=new J("async")}function U(t,s,i=e){let r;if(r=$.get(t).get(s))return r;let n,o=null;const h=new Set,l=t=>{a(t)||u(t)||c(t)},c=e=>{if(function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}(o,e)){o=e;const i=!X.length;for(let t of h)t[1](),X.push([t[0],o]);if(i){t.setItem(s,o);for(let t of X)t[0](t[1]);X.length=0}}};return r={subscribe:(t,s=e)=>{if(d(t)){const r=[t,s];return h.add(r),1===h.size&&(n=i(c)??e),t(o),()=>{h.delete(r),0===h.size&&n&&(n(),n=null)}}},set:c,update:t=>{d(t)&&c(t(o))},get:(e=null)=>{let i=t.getItem(s);return null===i?(d(e)&&((e=e())instanceof Promise?e.then((t=>l(t))):l(e)),e):i}},Object.defineProperty(r,"length",{configurable:!0,get:()=>h.size}),$.get(t).set(s,r),r}class F{get type(){return J.SYNC}constructor(t=""){t&&!t.endsWith(":")&&(t+=":"),V.set(this,t),$.set(this,new Map)}static get type(){return this.prototype.type}key(t){return V.get(this)+t}subscribe(t,s,i=e){return this.hook(t).subscribe(s,i)}hasItem(t){return null!==this.getItem(t)}removeItem(t){this.setItem(t,null)}setMany(t={}){const e=new Map;for(let s in t){const i=t[s];e.set(s,this.setItem(s,i))}return e}getMany(t=[],e=null){return t.map((t=>[t,this.getItem(t,e)]))}hook(t,e=null){return U(this,t,(s=>{s(this.getItem(t,e))}))}clear(){const t=this.keys;for(let e of t)this.removeItem(e);return t}get keys(){throw new Error(g(this)+".keys not implemented.")}getItem(t,e=null){return d(e)&&((e=e())instanceof Promise?e.then((e=>this.setItem(t,e))):this.setItem(t,e)),e}setItem(t,e){throw new Error(g(this)+".setItem() not implemented.")}}if("undefined"==typeof Storage){const t=new Map;class e{get length(){return t.size}key(e){return[...t.keys()][e]??null}clear(){t.clear()}getItem(e){return t.get(e)??null}setItem(e,s){t.set(String(e),String(s))}getItem(e){return t.get(e)??null}removeItem(e){t.delete(e)}}globalThis.Storage??=e,globalThis.localStorage??=new e,globalThis.sessionStorage??=new e,globalThis.addEventListener??=()=>{},globalThis.removeEventListener??=()=>{}}const R="NGSOFT:UUID";function W(){let e="";return t?(null===(e=localStorage.getItem(R))&&localStorage.setItem(R,e=function(){let t,e,s="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(s+="-"),s+=(12==t?4:16==t?3&e|8:e).toString(16);return s}()+":"),e):e}class z extends F{#l;get store(){return this.#l}constructor(t,e=W()){if(t??=localStorage,t instanceof Storage==!1)throw new TypeError("storage not an instance of Storage");super(e),this.#l=t}get keys(){const t=[],e=this.key(""),{store:s}=this;for(let i=0;i<s.length;i++){let r=s.key(i);r.startsWith(e)&&t.push(r.slice(e.length))}return t}getItem(t,e=null){let s=this.store.getItem(this.key(t));return o(s)?super.getItem(t,y(s)):super.getItem(t,e)}setItem(t,e){return null===e?this.store.removeItem(this.key(t)):this.store.setItem(this.key(t),w(e)),e}hook(t,e=null){return U(this,t,(s=>{const i=e=>{e.storageArea===this.store&&e.key===this.key(t)&&s(y(e.newValue))};return addEventListener("storage",i),s(this.getItem(t,e)),()=>{removeEventListener("storage",i)}}))}}const K=new z;new z(sessionStorage);const B=K.hook("muted",!1);[...Array(8)].map(((t,e)=>D+"/soundtrack/"+(e+1)+".ogg"));const Q=".ogg",Z=new Map,_=document.querySelector("#audioplayers");class tt extends I{static Stage1=new tt(1);static Stage2=new tt(2);static Stage3=new tt(3);static Stage4=new tt(4);static Stage5=new tt(5);static Stage6=new tt(6);static Stage7=new tt(7);static Stage8=new tt(8);static pauseAll(){this.cases().forEach((t=>t.pause()))}get url(){return b(D+"/soundtrack/"+this.value+Q)}set player(t){Z.set(this,t),B.subscribe((e=>{t.muted=e||null}))}get player(){return Z.get(this)}play(){return this.load(),st(this.player)}pause(){this.player?.pause()}destroy(){this.pause(),Z.delete(this)}load(){if(!Z.has(this)){const t=E("audio",{src:this.url});_.appendChild(t),this.player=t}}}class et extends I{static DEATH=new et("death");static DROP=new et("drop");static HIT=new et("hit");static JUMP=new et("jump");static LEVEL=new et("level");static pauseAll(){this.cases().forEach((t=>t.pause()))}get url(){return b(D+"/effects/"+this.value+Q)}set player(t){Z.set(this,t),B.subscribe((e=>{t.muted=e||null}))}get player(){return Z.get(this)}play(){return this.load(),st(this.player)}pause(){this.player?.pause()}destroy(){this.pause(),Z.delete(this)}load(){if(!Z.has(this)){const t=E("audio",{src:this.url});_.appendChild(t),this.player=t}}}function st(t){return new Promise(((e,s)=>{if(m(t)){if(t.currentTime=0,setTimeout((()=>{e(t)}),1e3*t.duration+200),t.paused&&!t.muted)try{t.play()}catch(t){console.warn(t)}}else s(new TypeError("not an element"))}))}let it=0;const rt=new Set;function nt(t=e){let s=0;return e=>{s++,it++,e.onload=()=>{s--,it--,0===s&&(t(),0===it&&rt.forEach((t=>t())))}}}const at=nt();function ot(t,e=!0){let s=0,i=0;const r=t.map((t=>{const e=new Image;return at(e),e.src=t,e}));return()=>{let t=!0;return i++,i%4==0&&s++,s>=r.length&&(s=0,t=e),t&&r[s]}}const ht=new Map([["moving",[[...Array(9)].map(((t,e)=>N+"/moving/"+(e+1)+".png")),!0]],["attacking",[[...Array(6)].map(((t,e)=>N+"/attacking/"+(e+1)+".png")),!1]],["dead",[[...Array(10)].map(((t,e)=>N+"/dead/"+(e+1)+".png")),!1]]]);class lt extends I{static MOVING=new lt("moving");static ATTACKING=new lt("attacking");static DEAD=new lt("dead");get sprites(){return ht.get(this.value)[0]}#c;getAnimation(){return this.#c??=ot(...ht.get(this.value))}}class ct extends O{maxHP=6;hp=6;killCount=0;x=100;y=350;width=150;height=150;minY=150;maxY=350;gravity=1;jumpStep=15;deltaY=0;isJumping=!1;isAttacking=!1;isDead=!1;state=lt.MOVING;currentSprite=!1;intercepting=[];draw(){const{ctx:t}=this;this.isJumping&&this.jump(),this.isAttacking&&this.attack(),this.isAttacking||this.move(),this.intersections(),this.isDead&&this.dead(),t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}dead(){this.isDead&&(this.state=lt.DEAD,!1===(this.currentSprite=this.state.getAnimation(this)())&&(this.world.pause(),this.world.trigger("dead",{item:this})))}move(){this.state=lt.MOVING,this.currentSprite=this.state.getAnimation(this)()}attack(){this.isAttacking&&(this.state=lt.ATTACKING,!1===(this.currentSprite=this.state.getAnimation(this)())&&(this.isAttacking=!1)),this.isAttacking||(this.state=lt.MOVING,this.move())}jump(){if(this.isJumping){if(0===this.deltaY)this.deltaY=-this.jumpStep*this.gravity;else if(this.y<=this.minY)this.deltaY=-1*this.deltaY,this.y=this.minY;else if(this.y>=this.maxY)return this.deltaY=0,this.isJumping=!1,void(this.y=this.maxY);this.y+=this.deltaY}}intersections(){this.intercepting=this.intercepting.filter((t=>!(t.destroyed||!t.isIntersecting(this))));for(let t of[...this.world.objects])t.isIntersecting(this)&&!this.intercepting.includes(t)&&t.scoreGain>0&&(this.intercepting.push(t),!t.isEnemy||this.isAttacking?(this.world.score+=t.scoreGain,this.world.destroyObject(t),t instanceof H&&et.DROP.play(),t.isEnemy&&(this.killCount++,this.world.stage.generateEnemy()),this.world.trigger("scoregain",{item:t})):t.isEnemy&&(this.hp--,this.world.trigger("hploss",{item:t}),this.hp<=0?(et.DEATH.play(),this.isDead=!0):et.HIT.play()))}}const ut=[[...Array(9)].map(((t,e)=>P+"/cyclops/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>P+"/minos/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>P+"/wherewolf/"+(e+1)+".png")),[...Array(9)].map(((t,e)=>P+"/orc/"+(e+1)+".png"))],dt=new Map([["moving",[[...Array(9)].map(((t,e)=>P+"/demon/moving/"+(e+1)+".png")),!0]]]),gt=new Map;class pt extends I{static MOVING=new pt("moving");get sprites(){return dt.get(this.value)[0]}getAnimation(t){return gt.has(t)||gt.set(t,ot(t.sprites)),gt.get(t)}}class mt extends O{isEnemy=!0;isDead=!1;#h;get scoreGain(){return this.#h??=Math.ceil(500*Math.random())}get width(){return this.world.hero.width}get height(){return this.world.hero.height}get y(){return this.world.hero.maxY}set y(t){}#o;get x(){return this.#o??=this.world.width+Math.floor(Math.random()*this.world.width*Math.ceil(3*Math.random()))}set x(t){this.#o=t}#u;get sprites(){return this.#u??=ut[Math.floor(Math.random()*ut.length)]}state=pt.MOVING;currentSprite=!1;draw(){const{ctx:t}=this;this.move(),this.x>this.world.width-this.width||t.drawImage(this.currentSprite,this.x,this.y,this.width,this.height)}move(){this.state=pt.MOVING,this.world.hero.isDead||(this.currentSprite=this.state.getAnimation(this)(),this.x-=this.world.stage.speed),this.x<=0&&(this.#o=null)}destroy(){super.destroy(),this.isDead=!0}}const ft=nt();const yt=[...Array(8)].map(((t,e)=>q+"/stage"+(e+1)+".png")).map((function(t){const e=new Image;return ft(e),e.src=t,e}));class wt extends O{#d=0;get level(){return this.#d}set level(t){this.#d=t,this.reset(),this.world.trigger("levelchange")}enemies=0;enemiesPerStageRatio=5;get soundtrack(){return tt.cases()[this.level]}get maxEnemies(){return this.stage*this.enemiesPerStageRatio}get stage(){return this.level+1}loops=0;loopIncreased=!1;get maxLoops(){return this.world.loopsToClearStage}speed=10;deltaX=0;x=0;y=0;get width(){return this.world.width}get height(){return this.world.height}get decor(){return yt[this.level]??yt.slice(-1)[0]}reset(){this.enemies=this.deltaX=this.loops=0,this.loopIncreased=!1,this.world.objects.length=0}draw(){this.generateEnemies();const{decor:t,ctx:e}=this;this.world.hero.isDead||(this.deltaX+=this.speed),this.deltaX>=this.width&&(this.deltaX=0,this.loops++,this.loopIncreased=!0,this.loops>=this.maxLoops&&(et.LEVEL.play(),this.world.pause(),this.world.trigger("stagecleared"))),e.drawImage(t,this.deltaX,0,this.width-this.deltaX,this.height,0,0,this.width-this.deltaX,this.height),e.drawImage(t,0,0,this.deltaX,this.height,this.width-this.deltaX,0,this.deltaX,this.height)}generateEnemy(){this.enemies<this.maxEnemies&&(this.world.objects.push(new mt(this.world)),this.world.objects.push(new H(this.world)))}generateEnemies(){(0===this.enemies||this.loopIncreased)&&(this.loopIncreased&&(this.loopIncreased=!1),this.enemies<this.maxEnemies&&(this.generateEnemy(),this.enemies++))}constructor(t){super(t),t.on("started resume levelchange",(()=>{tt.pauseAll(),this.soundtrack.play()})).on("paused stagecleared",(()=>{this.soundtrack.pause()}))}}class vt{#g;#p;get length(){return this.#g.length}constructor(t=!0){this.#g=[],this.#p=!0===t}on(t,e,s=!1){if(!o(t))throw new TypeError("Invalid event type, not a String.");if(!d(e))throw new TypeError("Invalid listener, not a function");return t.split(/\s+/).forEach((t=>{this.#g.push({type:t,listener:e,once:!0===s})})),this}one(t,e){return this.on(t,e,!0)}off(t,e){if(!o(t))throw new TypeError("Invalid event type, not a String.");return t.split(/\s+/).forEach((t=>{this.#g=this.#g.filter((s=>!!(t!==s.type||e!==s.listener&&e)))})),this}trigger(t,e=null,s=null){let i;if(s??=this.#p,t instanceof Event&&(i=t,i.data??=e,t=i.type),!o(t)&&t instanceof Event==!1)throw new TypeError("Invalid event type, not a String|Event.");const r=[];return t.split(/\s+/).forEach((t=>{if(!r.includes(t)){r.push(t);for(let r of function(t,e){return t.filter((t=>t.type===e))}(this.#g,t))r.type===t&&(s?p(r.listener,i??{type:t,data:e}):r.listener(i??{type:t,data:e}),r.once&&this.off(t,r.listener))}})),this}mixin(t){return t instanceof Object&&["on","off","one","trigger"].forEach((e=>{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:(...s)=>(this[e](...s),t)})})),this}static mixin(t,e=!0){return new vt(e).mixin(t)}static on(t,e,s=!1){return xt.on(t,e,s)}static one(t,e){return xt.one(t,e)}static off(t,e){return xt.off(t,e)}static trigger(t,e=null,s=null){return xt.trigger(t,e,s)}}const xt=new vt;let St={set(t,e,s){Et.includes(s)&&this.remove(t,e),bt(e).forEach((e=>{t.dataset[e]=w(s)}))},get(t,e,s=null){let i=bt(e).map((e=>y(t.dataset[e]))).map((t=>Et.includes(t)?s:t));return i.length<=1?i[0]??s:i},remove(t,e){bt(e).forEach((e=>delete t.dataset[e]))}},Et=[null,undefined];function bt(t){let e=[];return o(t)&&(t.startsWith("data-")&&(t=t.slice(5)),e=[f(t)]),c(t)&&(e=e.concat(...t.map((t=>bt(t))))),e}function It(t){return kt(t)?[t]:t instanceof NodeList?[...t]:c(t)?t.filter((t=>kt(t))):function(t){try{return o(t)&&null===r.createElement("template").querySelector(t)}catch(t){return!1}}(t)?[...document.querySelectorAll(t)]:[]}function kt(t){return t instanceof Object&&t.dataset instanceof DOMStringMap}let At=!1;class Mt{element;paused=!0;timeout=null;score=0;loopsToClearStage=10;objects=[];get ctx(){return this.canvas.getContext("2d")}get width(){return y(this.canvas.width)}get height(){return y(this.canvas.height)}get time(){const t=T.of(this.chrono.elapsed);return(t.hours>0?t.hours+":":"")+t.minutes+":"+t.seconds}constructor({element:t}={}){vt.mixin(this,!1),this.element=t,this.chrono=new M(!1),this.displayScore=t.querySelector("#score"),this.displayTime=t.querySelector("#time"),this.displayHP=t.querySelector("#lives"),this.canvas=t.querySelector("canvas")}destroy(){this.pause(),At=!1,this.objects.forEach((t=>t.destroy())),requestAnimationFrame((()=>this.clearScreen()))}destroyObject(t){if(t instanceof O){let e=this.objects.indexOf(t);e>-1&&(t.destroy(),this.objects.splice(e,1))}}init(){At||(this.stage=new wt(this),this.hero=new ct(this),this.objects.length=0,this.resume())}pause(){this.paused||(this.paused=!0,this.chrono.pause(),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.trigger("paused"))}resume(){this.paused&&(this.paused=!1,this.chrono.stopped?(this.chrono.start(),this.trigger("started")):(this.chrono.resume(),this.trigger("resume")),requestAnimationFrame((()=>this.draw())))}clearScreen(){this.ctx.clearRect(0,0,this.width,this.height)}draw(){if(this.paused)return;const{displayScore:t,displayTime:e,displayHP:s}=this;this.clearScreen(),this.stage.draw(),this.objects.forEach((t=>t.draw())),this.hero.draw(),t.innerHTML=this.score,e.innerHTML=this.time,function(t,e,s){function i(e,s=null){let i=t[0];return kt(i)?St.get(i,e,s):s}function r(e,s){if(n(e))for(let t in e)r(t,e[t]);else t.forEach((t=>St.set(t,e,s)));return a}t=It(t);const a={get:i,set:r,remove:function(e){return t.forEach((t=>St.remove(t,e))),a}};switch(arguments.length){case 2:return i(e);case 3:return r(e,s)}}(s,"lives",this.hero.hp),this.timeout=setTimeout((()=>{requestAnimationFrame((()=>this.draw()))}),16)}}const Tt=document.querySelector(".start-menu"),jt=document.querySelector(".death-container"),Ot=document.querySelector(".level"),Dt=document.querySelector(".victory"),Lt=document.querySelector(".pause"),qt=document.querySelector(".credits");let Nt;addEventListener("keydown",(t=>{const{key:e}=t;if(" "===e){if(Nt.paused)return;t.preventDefault(),Nt.hero.isJumping||(Nt.hero.isJumping=!0,et.JUMP.play())}else if("p"===e)t.preventDefault(),Nt.paused?Nt.resume():Nt.pause();else if("e"===e){if(Nt.paused)return;t.preventDefault(),Nt.hero.isAttacking||(Nt.hero.isAttacking=!0)}})),addEventListener("click",(({target:t})=>{Nt&&(Nt.paused||t.closest("#game")&&!Nt.hero.isAttacking&&(Nt.hero.isAttacking=!0))})),Tt.addEventListener("click",(t=>{const{target:e}=t;e.closest(".start-menu-btn")?(Nt=new Mt({element:document.querySelector("#game")}),Nt.on("paused",(()=>{Lt.hidden=null})).on("resume started",(()=>{Lt.hidden=!0})).on("stagecleared",(()=>{Lt.hidden=!0,8===Nt.stage.stage?Dt.hidden=null:(Ot.hidden=null,setTimeout((()=>{Ot.hidden=!0,Nt.stage.level++}),3500))})).on("dead",(()=>{jt.querySelector(".score-span").innerHTML=document.querySelector("#score").innerHTML,jt.querySelector(".time-span").innerHTML=document.querySelector("#time").innerHTML,Lt.hidden=!0,jt.hidden=null})).on("levelchange",(()=>{const{hero:t,score:e}=Nt;for(;t.hp<t.maxHP&&e>=1e3;)Nt.score-=1e3,t.hp++;Nt.resume()})),Tt.hidden=!0,Nt.init()):e.closest(".start-menu-credit")&&(qt.hidden=null)})),qt.addEventListener("click",(()=>{qt.hidden=!0})),Lt.addEventListener("click",(({target:t})=>{t.closest("button")&&Nt.resume()})),jt.addEventListener("click",(({target:t})=>{t.closest(".retry")&&(jt.hidden=!0,Nt.destroy(),Tt.hidden=null)})),Dt.addEventListener("click",(()=>{Dt.hidden=!0,Nt?.destroy(),Tt.hidden=null}));
